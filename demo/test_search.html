<!DOCTYPE html>
<html lang="de">
<head>
    <title>Spielersuche testen</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .loading { color: blue; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; }
        #results { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Spielersuche testen</h1>
    
    <button onclick="testSearch('Tran')">Nach "Tran" suchen</button>
    <button onclick="testSearch('Test')">Nach "Test" suchen</button>
    <button onclick="testSearch('X')">Nach "X" suchen</button>
    
    <div id="results"></div>

    <script>
        async function testSearch(query) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">Suche nach "' + query + '"... Dies kann 15-30 Sekunden dauern.</div>';
            
            try {
                // Custom timeout implementation
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Anfrage-Timeout nach 30 Sekunden')), 30000);
                });

                const fetchPromise = fetch('http://localhost:8080/api/v1/players?query=' + encodeURIComponent(query) + '&limit=3')
                    .then(response => response.json());

                const result = await Promise.race([fetchPromise, timeoutPromise]);
                
                const players = result.data?.data || result.data || [];
                
                let html = '<div class="success">Suche abgeschlossen! ' + (players.length || 0) + ' Spieler gefunden:</div>';
                if (players.length > 0) {
                    html += '<ul>';
                    players.forEach(player => {
                        const fullName = ((player.firstname || '') + ' ' + (player.name || '')).trim() || 'N/A';
                        html += '<li><strong>' + fullName + '</strong> - ID: ' + (player.id || 'N/A') + ' - Verein: ' + (player.club || 'N/A') + '</li>';
                    });
                    html += '</ul>';
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = '<div class="error">Fehler: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>
